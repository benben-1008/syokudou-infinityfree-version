<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚ªãƒªãƒŸãƒ«</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* èƒŒæ™¯ç”»åƒè¨­å®šï¼ˆoliveï¼‰ */
    .page-bg {
      background-image: url('images/olive.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    /* å¯èª­æ€§ã‚’ä¿ã¤ãŸã‚ã®åŠé€æ˜èƒŒæ™¯ */
    .container {
      background-color: rgba(255, 255, 255, 0.92);
    }
  </style>
</head>

<body class="page-bg">
  <div class="container">
    <header>
      <h1>ğŸ½ï¸ ã‚ªãƒªãƒŸãƒ«</h1>
      <p>ç”Ÿå¾’ç”¨ã‚µã‚¤ãƒˆ</p>
    </header>

    <main>
      <section class="status-section">
        <h2>ğŸ“… å–¶æ¥­çŠ¶æ³</h2>
        <div id="status-display" class="status-card"></div>
        <div id="today-menu" class="status-card" style="margin-top: 10px;"></div>
      </section>

      <section class="info-section">
        <div class="holiday-header" onclick="toggleHolidayList()"
          style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 10px; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
          <h2 style="margin: 0;">ğŸ“… ä»Šå¾Œã®ä¼‘æ¥­æ—¥</h2>
          <span id="holiday-toggle-icon" style="font-size: 20px; transition: transform 0.3s;">â–¼</span>
        </div>
        <div id="holidays-list-container" class="info-card" style="display: none;">
          <div id="holidays-list"></div>
        </div>
      </section>

      <section class="info-section">
        <h2>ğŸ“… å–¶æ¥­ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
        <div id="calendar" class="info-card calendar-container"></div>
      </section>

      <section class="links-section">
        <h2>ğŸ”— ä¾¿åˆ©ãªãƒªãƒ³ã‚¯</h2>
        <div class="link-cards">
          <a href="reservation.php" class="link-card">
            <div class="link-icon">ğŸ“</div>
            <h3>äºˆç´„ã‚µã‚¤ãƒˆ</h3>
          </a>
          <a href="verification.html" class="link-card">
            <div class="link-icon">ğŸ”</div>
            <h3>äºˆç´„ç¢ºèªã‚·ã‚¹ãƒ†ãƒ </h3>
          </a>
          <a href="ai-assistant-php.html" class="link-card">
            <div class="link-icon">ğŸ¤–</div>
            <h3>é£Ÿå ‚å°‚ç”¨AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h3>
          </a>
          <a href="review.html" class="link-card">
            <div class="link-icon">â­</div>
            <h3>ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿</h3>
          </a>
          <a href="allergy.html" class="link-card">
            <div class="link-icon">ğŸ½ï¸</div>
            <h3>ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±</h3>
          </a>
        </div>
      </section>

      <section class="info-section">
        <h2>ğŸ”— URLãƒªãƒ³ã‚¯</h2>
        <div id="page-links" class="info-card"></div>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 å­¦æ ¡é£Ÿå ‚ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
    </footer>
  </div>

  <script>
    // èƒŒæ™¯ç”»åƒã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾ç­–
    document.addEventListener('DOMContentLoaded', function () {
      const pageBg = document.querySelector('.page-bg');
      if (pageBg) {
        const timestamp = new Date().getTime();
        pageBg.style.backgroundImage = `url('images/olive.jpg?v=${timestamp}')`;
      }
    });

    const API_BASE = 'api/';
    async function apiGet(path) {
      const res = await fetch(API_BASE + path, { cache: 'no-store' });
      if (!res.ok) throw new Error('GET failed: ' + path);
      return await res.json();
    }
    async function loadStatus() {
      const holidays = await apiGet('holidays.php');
      const dailyMenus = await apiGet('daily-menu.php');
      const statusDiv = document.getElementById("status-display");
      const todayMenuDiv = document.getElementById("today-menu");
      const today = new Date().toISOString().split("T")[0];
      const todayHoliday = holidays.find(h => h.date === today);
      const todayMenu = dailyMenus.find(m => m.date === today);

      // ä»Šæ—¥ãŒåœŸæ—¥ã‹ãƒã‚§ãƒƒã‚¯
      const todayObj = new Date();
      const dayOfWeek = todayObj.getDay(); // 0=æ—¥æ›œæ—¥, 6=åœŸæ›œæ—¥
      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

      if (todayHoliday || isWeekend) {
        const reason = todayHoliday?.reason || (dayOfWeek === 0 ? 'æ—¥æ›œæ—¥' : 'åœŸæ›œæ—¥');
        statusDiv.innerHTML = `<p>ğŸš« æœ¬æ—¥ï¼ˆ${today}ï¼‰ã¯ä¼‘æ¥­ã§ã™ã€‚<br>ç†ç”±: ${reason}</p>`;
        todayMenuDiv.innerHTML = "";
      } else {
        statusDiv.innerHTML = `<p>âœ… æœ¬æ—¥ã¯å–¶æ¥­ä¸­ã§ã™ã€‚</p>`;

        if (todayMenu) {
          todayMenuDiv.innerHTML = `<p>ğŸ½ï¸ æœ¬æ—¥ã®å®šé£Ÿã¯ã€Œ${todayMenu.food}ã€ã§ã™ã€‚</p>`;
        } else {
          todayMenuDiv.innerHTML = `<p>ğŸ½ï¸ æœ¬æ—¥ã®å®šé£Ÿã¯æœªè¨­å®šã§ã™ã€‚</p>`;
        }
      }

      // ä»Šå¾Œã®ä¼‘æ¥­æ—¥
      const listDiv = document.getElementById("holidays-list");
      if (holidays.length === 0) {
        listDiv.innerHTML = "<p>ç™»éŒ²ã•ã‚ŒãŸä¼‘æ¥­æ—¥ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
      } else {
        listDiv.innerHTML = holidays
          .map(h => `<p>ğŸ“… ${h.date}ã€€ğŸ“ ${h.reason || 'ä¼‘æ¥­æ—¥'}</p>`)
          .join("");
      }
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
    async function generateCalendar() {
      const calendarDiv = document.getElementById('calendar');
      const holidays = await apiGet('holidays.php');
      const dailyMenus = await apiGet('daily-menu.php');
      const events = await apiGet('events.php');
      const today = new Date();
      const currentMonth = today.getMonth();
      const currentYear = today.getFullYear();

      // æœˆã®æœ€åˆã®æ—¥ã¨æœ€å¾Œã®æ—¥ã‚’å–å¾—
      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼
      const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ',
        '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
      const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

      let calendarHTML = `
        <div class="calendar-header">
          <h4>${currentYear}å¹´ ${monthNames[currentMonth]}</h4>
        </div>
        <div class="calendar-grid">
          <div class="calendar-weekdays">
      `;

      // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
      dayNames.forEach(day => {
        calendarHTML += `<div class="calendar-weekday">${day}</div>`;
      });
      calendarHTML += `</div><div class="calendar-days">`;

      // ç©ºç™½ã®æ—¥ä»˜ï¼ˆæœˆã®æœ€åˆã®æ—¥ã‚ˆã‚Šå‰ï¼‰
      for (let i = 0; i < startingDayOfWeek; i++) {
        calendarHTML += `<div class="calendar-day empty"></div>`;
      }

      // å®Ÿéš›ã®æ—¥ä»˜
      for (let day = 1; day <= daysInMonth; day++) {
        const dateString = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayOfWeek = new Date(currentYear, currentMonth, day).getDay();
        const holiday = holidays.find(h => h.date === dateString);
        const dailyMenu = dailyMenus.find(m => m.date === dateString);
        const event = events.find(e => e.date === dateString);
        const isSunday = dayOfWeek === 0;
        const isSaturday = dayOfWeek === 6;
        // ä¼‘æ¥­æ—¥ã‹ã©ã†ã‹ï¼ˆç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ä¼‘æ¥­æ—¥ã¾ãŸã¯åœŸæ—¥ï¼‰
        const isHoliday = !!holiday || isSunday || isSaturday;

        let dayClass = 'calendar-day';
        let dayContent = day;

        if (isHoliday) {
          dayClass += ' holiday';
          if (holiday && holiday.reason) {
            dayContent = `${day}<br><small>${holiday.reason}</small>`;
          } else if (isSunday) {
            dayContent = `${day}<br><small>æ—¥æ›œæ—¥</small>`;
          } else if (isSaturday) {
            dayContent = `${day}<br><small>åœŸæ›œæ—¥</small>`;
          } else {
            dayContent = `${day}<br><small>ä¼‘æ¥­æ—¥</small>`;
          }
        } else if (dailyMenu) {
          dayContent = `${day}<br><small>${dailyMenu.food}</small>`;
        } else {
          dayClass += ' weekday';
        }

        // è¡Œäº‹ãƒ»ãŠçŸ¥ã‚‰ã›ãŒã‚ã‚‹å ´åˆã¯è¿½åŠ è¡¨ç¤º
        if (event) {
          if (isHoliday || dailyMenu) {
            dayContent += `<br><small style="color: #007bff;">ğŸ“¢ ${event.message}</small>`;
          } else {
            dayContent = `${day}<br><small style="color: #007bff;">ğŸ“¢ ${event.message}</small>`;
          }
        }

        calendarHTML += `<div class="${dayClass}">${dayContent}</div>`;
      }

      calendarHTML += `</div></div>`;
      calendarDiv.innerHTML = calendarHTML;
    }

    // ä¼‘æ¥­æ—¥ãƒªã‚¹ãƒˆã®æŠ˜ã‚ŠãŸãŸã¿
    function toggleHolidayList() {
      const container = document.getElementById('holidays-list-container');
      const icon = document.getElementById('holiday-toggle-icon');

      if (container.style.display === 'none') {
        container.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
      } else {
        container.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
      }
    }

    function renderLinks() {
      const base = window.location.href.replace(/[^/]*$/, '');
      const pages = [
        { name: 'ç”Ÿå¾’ç”¨ã‚µã‚¤ãƒˆ (index.html)', file: 'index.html' },
        { name: 'äºˆç´„ã‚µã‚¤ãƒˆ (reservation.php)', file: 'reservation.php' },
        { name: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ (review.html)', file: 'review.html' },
        { name: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ± (allergy.html)', file: 'allergy.html' },
        { name: 'é£Ÿå ‚å°‚ç”¨AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (ai-assistant-php.html)', file: 'ai-assistant-php.html' }
      ];
      const linksDiv = document.getElementById('page-links');
      if (!linksDiv) return;
      linksDiv.innerHTML = pages.map(p => {
        const url = base + p.file;
        return `<p><strong>${p.name}:</strong> <a href="${url}">${url}</a></p>`;
      }).join('');
    }

    window.onload = function () {
      loadStatus();
      generateCalendar();
      renderLinks();
    };
  </script>
</body>

</html>